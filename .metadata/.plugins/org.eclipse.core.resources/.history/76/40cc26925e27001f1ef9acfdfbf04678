package test;
import java.io.BufferedReader;
import java.io.DataOutputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;
import java.net.URLEncoder;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Scanner;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;

public class Test2 {
    public static void llamadaApiGet(String cadena1, String cadena2, List<String> lista1, List<String> lista2, Map<String, String> diccionario, Map<String, Object> newdata) throws IOException {
        Gson gson = new Gson();

        // Convertir el diccionario y newdata a JSON y luego codificarlos
        String diccionarioJson = gson.toJson(diccionario);
        String newdataJson = gson.toJson(newdata);
        diccionarioJson = URLEncoder.encode(diccionarioJson, "UTF-8");
        newdataJson = URLEncoder.encode(newdataJson, "UTF-8");

        // Crear URL con parámetros de consulta
        String urlString = String.format(
            "http://localhost:8000/datos?diccionario=%s&newdata=%s&cadena1=%s&cadena2=%s",
            diccionarioJson,
            newdataJson,
            URLEncoder.encode(cadena1, "UTF-8"),
            URLEncoder.encode(cadena2, "UTF-8")
        );

        // Añadir parámetros de lista1
        for (String str : lista1) {
            urlString += "&lista1=" + URLEncoder.encode(str, "UTF-8");
        }

        // Añadir parámetros de lista2
        for (String str : lista2) {
            urlString += "&lista2=" + URLEncoder.encode(str, "UTF-8");
        }

        URL url = new URL(urlString);
        HttpURLConnection conn = (HttpURLConnection) url.openConnection();
        conn.setRequestMethod("GET");

        int responseCode = conn.getResponseCode();
        if (responseCode == 200) {
            Scanner scanner = new Scanner(conn.getInputStream());
            String response = scanner.useDelimiter("\\A").next();
            scanner.close();

            System.out.println("Respuesta de la API: " + response);
        } else {
            System.out.println("Error al llamar a la API: " + responseCode);
        }
    }

	    public static void main(String[] args) {
	        try {
	        	
	        	
	        	/*
	        	 * 
	        	 *     columndrop: List[str] = Query(...),
					    dummies: List[str] = Query(...),
					    tablename: str = Query(...),
					    dfcolumn: str = Query(...),
					    newdata: Dict[str, str] = Body(...)
	        	 * 
	        	 * 
	        	 * 
	        	 * 
	        	 * */
	            String tablename = "salario";
	            String dfcolumn = "Salarios";
	            List<String> columndrop = List.of("Nombre","Salario");
	            List<String> dummies = List.of("Género","Departamento");
	            Map<String, Object> newdata = Map.of(
	                    "Nombre", "Nuevo",
	                    "Edad", 36,
	                    "Género", "Femenino",
	                    "Departamento", "Finanzas"
	                );

	            llamadaApiGet(tablename, dfcolumn, columndrop, dummies, newdata);
	        } catch (IOException e) {
	            e.printStackTrace();
	        }
	    }


	}